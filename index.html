<!DOCTYPE html>
<!--
MoMo Data Dashboard
Team 11 - Enterprise Web Development
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoMo Data Dashboard</title>
    
    <!-- Recommended Neobrutalism Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Mega:wght@400;500;600;700&family=Public+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Neobrutalism CSS Framework -->
    <link rel="stylesheet" href="https://unpkg.com/neobrutalismcss@1.0.0/dist/index.min.css" />
    
    <link rel="stylesheet" href="web/styles.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="nb-navbar" role="navigation" aria-label="Main navigation">
        <a href="/" class="nb-navbar-brand" aria-label="Go to homepage">
            <div class="badge blue">
                <div class="badge-inner">
                    <p class="badge-text">MoMo</p>
                </div>
            </div>
        </a>
        <ul class="nb-navbar-nav" role="menubar">
            <li class="nb-navbar-item" role="none">
                <a href="#overview" class="nb-navbar-link active" role="menuitem" aria-current="page">Overview</a>
            </li>
            <li class="nb-navbar-item" role="none">
                <a href="#transactions" class="nb-navbar-link" role="menuitem">Transactions</a>
            </li>
            <li class="nb-navbar-item" role="none">
                <a href="#analytics" class="nb-navbar-link" role="menuitem">Analytics</a>
            </li>
            <li class="nb-navbar-item" role="none">
                <a href="#reports" class="nb-navbar-link" role="menuitem">Reports</a>
            </li>
        </ul>
    </nav>

    <!-- Breadcrumb -->
    <nav class="nb-breadcrumb" role="navigation" aria-label="Breadcrumb">
        <div class="nb-breadcrumb-item">
            <a href="/" class="nb-breadcrumb-link" aria-label="Go to homepage">Home</a>
        </div>
        <div class="nb-breadcrumb-item">
            <span class="nb-breadcrumb-current" aria-current="page">Dashboard</span>
        </div>
        </nav>

    <main class="nb-container">
        <!-- Page Header -->
        <div class="nb-section">
            <h1 class="nb-text-4xl nb-text-center nb-text-black" style="font-family: 'Lexend Mega', sans-serif;">MoMo Data Processing Dashboard</h1>
            <p class="nb-text-center nb-text-lg" style="font-family: 'Public Sans', sans-serif;">Real-time Mobile Money Transaction Analytics</p>
        </div>

        <!-- Stats Grid Section -->
        <div class="nb-section">
            <h2 class="nb-section-title">System Overview</h2>
            <div class="nb-grid nb-grid-4 nb-gap-3">
                <!-- Total Transactions Card -->
                <div class="nb-card nb-stat-card">
                    <div class="nb-card-content">
                        <div class="nb-card-header">
                            <div class="nb-flex nb-flex-row nb-items-center nb-mb-2">
                                <div class="badge green">
                                    <div class="badge-inner">
                                        <p class="badge-text">SUCCESS</p>
                                    </div>
                                </div>
                                <h4 class="nb-card-title nb-ml-2">TRANSACTIONS</h4>
                            </div>
                            <p class="nb-card-subtitle">Total MoMo payment transactions processed today</p>
                        </div>
                        <div class="nb-card-body">
                            <div class="nb-stat-value" id="total-transactions">1,247</div>
                            <div class="nb-stat-change nb-text-green-600">+12.5% from yesterday</div>
                        </div>
                    </div>
                </div>

                <!-- Revenue Card -->
                <div class="nb-card nb-stat-card">
                    <div class="nb-card-content">
                        <div class="nb-card-header">
                            <div class="nb-flex nb-flex-row nb-items-center nb-mb-2">
                                <div class="badge orange">
                                    <div class="badge-inner">
                                        <p class="badge-text">REVENUE</p>
                                    </div>
                                </div>
                                <h4 class="nb-card-title nb-ml-2">AMOUNT</h4>
                            </div>
                            <p class="nb-card-subtitle">Total RWF revenue generated through payments</p>
                        </div>
                        <div class="nb-card-body">
                            <div class="nb-stat-value" id="total-amount">2,450,000</div>
                            <div class="nb-stat-change nb-text-green-600">+8.2% growth rate</div>
                        </div>
                    </div>
                </div>

                <!-- Success Rate Card -->
                <div class="nb-card nb-stat-card">
                    <div class="nb-card-content">
                        <div class="nb-card-header">
                            <div class="nb-flex nb-flex-row nb-items-center nb-mb-2">
                                <div class="badge blue">
                                    <div class="badge-inner">
                                        <p class="badge-text">RATE</p>
                                    </div>
                                </div>
                                <h4 class="nb-card-title nb-ml-2">SUCCESS</h4>
                            </div>
                            <p class="nb-card-subtitle">Transaction success rate percentage</p>
                        </div>
                        <div class="nb-card-body">
                            <div class="nb-stat-value" id="success-rate">98.7%</div>
                            <div class="nb-stat-change nb-text-green-600">+0.3% improvement</div>
                        </div>
                    </div>
                </div>

                <!-- Active Users Card -->
                <div class="nb-card nb-stat-card">
                    <div class="nb-card-content">
                        <div class="nb-card-header">
                            <div class="nb-flex nb-flex-row nb-items-center nb-mb-2">
                                <div class="badge default">
                                    <div class="badge-inner">
                                        <p class="badge-text">USERS</p>
                                    </div>
                                </div>
                                <h4 class="nb-card-title nb-ml-2">ACTIVE</h4>
                            </div>
                            <p class="nb-card-subtitle">Active users in the system today</p>
                        </div>
                        <div class="nb-card-body">
                            <div class="nb-stat-value" id="active-users">3,421</div>
                            <div class="nb-stat-change nb-text-green-600">+156 new users</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="nb-section">
            <h2 class="nb-section-title">Analytics & Trends</h2>
            <div class="nb-grid nb-grid-2 nb-gap-4">
                <!-- Transaction Trends Chart -->
                <div class="nb-card">
                    <div class="nb-card-content">
                        <div class="nb-card-header">
                            <h3 class="nb-card-title">Transaction Trends</h3>
                            <p class="nb-card-subtitle">Daily transaction volume over time</p>
                        </div>
                        <div class="nb-card-body">
                            <div id="transaction-chart" style="height: 400px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Category Distribution Chart -->
                <div class="nb-card">
                    <div class="nb-card-content">
                        <div class="nb-card-header">
                            <h3 class="nb-card-title">Category Distribution</h3>
                            <p class="nb-card-subtitle">Transaction types breakdown</p>
                        </div>
                        <div class="nb-card-body">
                            <div id="category-chart" style="height: 400px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Transactions Table Section -->
        <div class="nb-section">
            <h2 class="nb-section-title">Recent Transactions</h2>
            <div class="nb-table-container">
                <div class="nb-table-header">Transaction History</div>
                <div class="nb-table-wrapper">
                    <table class="nb-table" id="transactions-table">
                        <thead>
                            <tr>
                                <th>Transaction ID</th>
                                <th>Amount (RWF)</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Phone Number</th>
                                <th>Date & Time</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-tbody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div class="nb-table-footer">
                    <button class="nb-button blue" onclick="loadMoreTransactions()">Load More Transactions</button>
                </div>
            </div>
        </div>

        <!-- System Status Section -->
        <div class="nb-section">
            <h2 class="nb-section-title">System Status</h2>
            <div class="nb-grid nb-grid-3 nb-gap-3">
                <!-- ETL Status -->
                <div class="nb-card">
                    <div class="nb-card-content">
                        <div class="nb-card-header">
                            <h4 class="nb-card-title">ETL Status</h4>
                            <p class="nb-card-subtitle">Data processing pipeline</p>
                        </div>
                        <div class="nb-card-body">
                            <div class="nb-progress">
                                <div class="nb-progress-bar" style="width: 85%"></div>
                                <div class="nb-progress-text">85%</div>
                            </div>
                            <p class="nb-text-sm nb-text-center">Data processing in progress</p>
                        </div>
                    </div>
                </div>

                <!-- Database Health -->
                <div class="nb-card">
                    <div class="nb-card-content">
                        <div class="nb-card-header">
                            <h4 class="nb-card-title">Database Health</h4>
                            <p class="nb-card-subtitle">System connectivity status</p>
                        </div>
                        <div class="nb-card-body">
                            <div class="nb-flex nb-flex-row nb-items-center nb-justify-center">
                                <div class="avatar avatar-sm green">✓</div>
                                <span class="nb-ml-2">All systems operational</span>
                            </div>
                            <p class="nb-text-sm nb-text-center">Last updated: 2 minutes ago</p>
                        </div>
                    </div>
                </div>

                <!-- API Status -->
                <div class="nb-card">
                    <div class="nb-card-content">
                        <div class="nb-card-header">
                            <h4 class="nb-card-title">API Status</h4>
                            <p class="nb-card-subtitle">Service performance metrics</p>
                        </div>
                        <div class="nb-card-body">
                            <div class="nb-flex nb-flex-row nb-items-center nb-justify-center">
                                <div class="avatar avatar-sm blue">API</div>
                                <span class="nb-ml-2">Response time: 45ms</span>
                            </div>
                            <p class="nb-text-sm nb-text-center">99.9% uptime</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons Section -->
        <div class="nb-section">
            <h2 class="nb-section-title">Actions</h2>
            <div class="nb-flex nb-flex-row nb-justify-center nb-gap-4">
                <button class="nb-button green" onclick="refreshData()">Refresh Data</button>
                <button class="nb-button blue" onclick="exportData()">Export Report</button>
                <button class="nb-button orange" onclick="runETL()">Run ETL</button>
            </div>
        </div>
    </main>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="nb-hidden" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;">
        <div class="nb-spinner"></div>
    </div>

    <!-- Scripts -->
    <script src="web/chart_handler.js"></script>
    <script>
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('MoMo Dashboard initialized');
            loadDashboardData();
            setupNavigation();
        });

        // Navigation functionality
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nb-navbar-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Remove active class from all links
                    navLinks.forEach(l => l.classList.remove('active'));
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Handle navigation
                    const target = this.getAttribute('href').substring(1);
                    showSection(target);
                });
            });
        }

        // Show specific section
        function showSection(section) {
            console.log('Showing section:', section);
            // Hide all sections
            const sections = document.querySelectorAll('main > div');
            sections.forEach(section => section.style.display = 'none');
            
            // Show specific section based on navigation
            // For now, just show all content
            sections.forEach(section => section.style.display = 'block');
        }

        // Load dashboard data
        async function loadDashboardData() {
            showLoading(true);
            try {
                // Load data from JSON file
                const response = await fetch('/data/processed/dashboard.json');
                if (response.ok) {
                    const data = await response.json();
                    updateDashboard(data);
                } else {
                    console.warn('Dashboard JSON not found, using sample data');
                    loadSampleData();
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                loadSampleData();
            }
            showLoading(false);
        }

        // Update dashboard with real data
        function updateDashboard(data) {
            if (data.summary) {
                document.getElementById('total-transactions').textContent = data.summary.total_transactions || '0';
                document.getElementById('total-amount').textContent = formatNumber(data.summary.total_amount || 0);
                document.getElementById('success-rate').textContent = (data.summary.success_rate || 0).toFixed(1) + '%';
            }
            
            if (data.transactions) {
                updateTransactionsTable(data.transactions);
            }
            
            // Update charts
            updateCharts(data);
        }

        // Load sample data
        function loadSampleData() {
            const sampleData = {
                summary: {
                    total_transactions: 1247,
                    total_amount: 2450000,
                    success_rate: 98.7
                },
                transactions: [
                    { id: 'TXN001', amount: 50000, type: 'Transfer', status: 'Success', phone: '+250791234567', date: '2024-05-16 10:30' },
                    { id: 'TXN002', amount: 25000, type: 'Payment', status: 'Success', phone: '+250788765432', date: '2024-05-16 10:25' },
                    { id: 'TXN003', amount: 100000, type: 'Deposit', status: 'Success', phone: '+250790123456', date: '2024-05-16 10:20' },
                    { id: 'TXN004', amount: 15000, type: 'Withdrawal', status: 'Success', phone: '+250799876543', date: '2024-05-16 10:15' },
                    { id: 'TXN005', amount: 75000, type: 'Transfer', status: 'Success', phone: '+250791111111', date: '2024-05-16 10:10' }
                ]
            };
            
            updateDashboard(sampleData);
        }

        // Update transactions table
        function updateTransactionsTable(transactions) {
            const tbody = document.getElementById('transactions-tbody');
            tbody.innerHTML = '';
            
            transactions.slice(0, 10).forEach(tx => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${tx.id}</td>
                    <td>${formatNumber(tx.amount)} RWF</td>
                    <td><span class="badge ${getTypeBadgeClass(tx.type)}"><div class="badge-inner"><p class="badge-text">${tx.type}</p></div></span></td>
                    <td><span class="badge ${tx.status === 'Success' ? 'green' : 'orange'}"><div class="badge-inner"><p class="badge-text">${tx.status}</p></div></span></td>
                    <td>${tx.phone}</td>
                    <td>${tx.date}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Get badge class for transaction type
        function getTypeBadgeClass(type) {
            const typeMap = {
                'Transfer': 'blue',
                'Payment': 'green',
                'Deposit': 'orange',
                'Withdrawal': 'default'
            };
            return typeMap[type] || 'default';
        }

        // Update charts
        function updateCharts(data) {
            // Transaction trends chart
            const transactionData = [
                {
                    x: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    y: [1200, 1350, 1100, 1400, 1600, 1800, 1247],
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Transactions',
                    line: { color: '#FF6B35', width: 4 },
                    marker: { size: 8 }
                }
            ];

            const transactionLayout = {
                title: { text: 'Daily Transaction Volume', font: { size: 16, family: 'Lexend Mega' } },
                xaxis: { title: 'Day' },
                yaxis: { title: 'Number of Transactions' },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                font: { family: 'Public Sans' }
            };

            Plotly.newPlot('transaction-chart', transactionData, transactionLayout, {responsive: true});

            // Category distribution chart
            const categoryData = [{
                values: [35, 25, 20, 15, 5],
                labels: ['Transfer', 'Payment', 'Deposit', 'Withdrawal', 'Other'],
                type: 'pie',
                marker: {
                    colors: ['#FF6B35', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57']
                }
            }];

            const categoryLayout = {
                title: { text: 'Transaction Categories', font: { size: 16, family: 'Lexend Mega' } },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                font: { family: 'Public Sans' }
            };

            Plotly.newPlot('category-chart', categoryData, categoryLayout, {responsive: true});
        }

        // Utility functions
        function formatNumber(num) {
            return new Intl.NumberFormat('en-RW').format(num);
        }

        function showLoading(show) {
            const spinner = document.getElementById('loading-spinner');
            if (show) {
                spinner.classList.remove('nb-hidden');
            } else {
                spinner.classList.add('nb-hidden');
            }
        }

        // Action functions
        function refreshData() {
            console.log('Refreshing data...');
            loadDashboardData();
        }

        function exportData() {
            console.log('Exporting data...');
            // Implement export functionality
            alert('Export functionality coming soon!');
        }

        function runETL() {
            console.log('Running ETL...');
            // Implement ETL trigger
            alert('ETL process started!');
        }

        function loadMoreTransactions() {
            console.log('Loading more transactions...');
            // Implement pagination
            alert('Loading more transactions...');
        }
    </script>
</body>
</html>